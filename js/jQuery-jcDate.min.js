!function(P){P.fn.jcDate=function(K){K=P.extend({IcoClass:"jcDateIco",Event:"click",Speed:100,Left:0,Top:22,format:"/",Timeout:100},K);return this.each(function(){0==P("#jcDate").length&&P("body").prepend("<div id='jcDate'><input type='hidden' value='' id='dateHideText' /><div id='jcDateTt'><a id='d_prev'></a><div><span></span><b>年</b><samp></samp><b>月</b></div><a id='d_next'></a></div><dl id='jcYeas'></dl><dl id='jcMonth'></dl><div id='jcDayWrap'><dl id='jcDayCon'></dl><div id='jcDateMax'><ul></ul><ul></ul><ul></ul><ul></ul><ul></ul><ul></ul><ul></ul><ul></ul><ul></ul><ul></ul><ul></ul><ul></ul></div><div id='jcDateBtn'><samp>今天</samp><span>清空</span><a id='d_sub'>确定</a><div id='jcTimeWrap'><input type='text' value='' /><label>:</label><input type='text' value='' /></div></div></div></div>");var e=P(this),t=(P(window),new Date),i=P("#jcDate"),f=(P(this).offset().left,P(this).offset().top,P("#jcDateTt").find("span")),n=P("#jcDateTt").find("samp"),s=P("#jcDateTt").find("b"),a=P("#jcDateMax"),d=P("#jcDayCon"),l=P("#jcDateBtn"),r=P("#jcYeas"),o=P("#jcMonth"),c=l.find("samp"),u=l.find("span"),v=P("#jcDayWrap"),p=v.find("ul"),h=l.find("a#d_sub"),D=P("input#dateHideText"),j=P("#jcTimeWrap"),m=j.find("input:eq(0)"),x=j.find("input:eq(1)"),C=P("#d_prev"),y=P("#d_next"),w=parseInt(t.getFullYear()),g=t.getMonth()+1,k=t.getDate(),I=["日","一 ","二 ","三 ","四 ","五 ","六 "],b=(t.getDay(),t.getHours(),t.getMinutes(),""),T="<dd class='visited'>"+w+"年</dd>",_="",A=0,q=function(e,t){return[31,e%4==0&&e%100!=0||e%400==0?29:28,31,30,31,30,31,31,30,31,30,31][t+1]};for(var V=0 in m.val("00"),x.val("00"),I)b=b+"<dt>"+I[V]+"</dt>";d.html(b);for(var L=w,M=new Array,Y=new Array,N=0;N<9;N++)lastyear=L-(N+1),M.push("<dt>"+lastyear+"年</dt>");M.reverse();for(var S=O(M),W=M.length=0;W<8;W++)firstyear=L+(W+1),M.push("<dt>"+firstyear+"年</dt>");var H=O(M);function O(e){var t="";for(var i=0 in e)t+=e[i];return t}r.html(S+T+H);for(var B=1;B<=12;B++)B==g?Y.push("<dt class='visited'>"+B+"月</dt>"):Y.push("<dt>"+B+"月</dt>");for(var E=0 in Y)_+=Y[E];function $(e,t,i,a,d){var l=K.speed;t.fadeOut(l),i.fadeOut(l),e.delay(2*l).fadeIn(l),a?(P("#d_prev,#d_next").fadeOut(l),s.eq(d).hide()):(P("#d_prev,#d_next").fadeIn(l),s.show(),f.show(),n.show())}function F(e){f.text(e);for(var t=0;t<p.length;t++){var i="",a="",d="",l="",n=new Date(e,t,1).getDay();null==q(e,t-2)?fristDay=31:fristDay=q(e,t-2);for(var s=1;s<=q(e,t-1);s++)i=i+"<li class='jcDateColor'>"+s+"</li>";for(var r=0;r<n;r++)l+="<li>"+fristDay+"</li>,",fristDay--;for(var o=0;o<=42-(s+n);o++)d+="<li>"+(o+1)+"</li>";for(var c=0 in fLiArr=l.split(",").reverse(),fLiArr)a+=fLiArr[c];$addLi=a+i+d,p.eq(t).html($addLi)}}function Q(e){p.eq(e).addClass("dateV").siblings().removeClass("dateV"),n.text(e+1),a.animate({left:161*-e},K.Speed)}function z(e,t,i){f.text(e),n.text(t),F(e),P.each(p.eq(t-1).find("li"),function(){P(this).hasClass("jcDateColor")&&p.eq(t-1).find("li.jcDateColor").eq(i-1).addClass("visited")}),D.val(k),p.eq(t-1).find("li").text(),Q(t-1)}function G(){var e=f.text(),t=n.text(),i=D.val();if(NowDateArr=new Array(e,t,i),dateInfo=NowDateArr.join(K.format),"00"!=m.val()||"00"!=x.val()){var a=m.val();t=x.val();NowDateArr.push(a+":"+t),printDate=NowDateArr.join(K.format).substring(),format=printDate.split("/"),dateInfo=format[0]+K.format+format[1]+K.format+format[2]+" "+format[3]}P("input.dateVisited").val(dateInfo),J()}function J(){P("input.dateVisited").removeClass("dateVisited"),i.hide(K.Speed)}o.html(_),f.die().live("click",function(){P(this).addClass("visited").next("samp").removeClass("visited"),$(r,v,o,!0,1),f.show(),n.hide()}),P("#jcYeas dd,#jcYeas dt").die().live("click",function(){var e=parseInt(P(this).text());F(e),f.text(e),$(v,r,o,!1)}),n.die().live("click",function(){P(this).addClass("visited").prev().removeClass("visited"),$(o,v,r,!0,0),n.show(),f.hide()}),o.find("dt").die().live("click",function(){var e=parseInt(P(this).text());Q(e-1),n.text(e),$(v,r,o,!1)}),Q(g-1),C.die().live("click",function(){if(0<(A=p.filter(".dateV").index()))A--;else{var e=parseInt(f.text());F(--e),A=p.length-1}Q(A)}),y.die().live("click",function(){if((A=p.filter(".dateV").index())<p.length-1)A++;else{var e=parseInt(f.text());F(++e),A=0}Q(A)}),z(w,g,k),p.undelegate("li.jcDateColor","click").delegate("li.jcDateColor","click",function(){P.each(P("li.jcDateColor",p),function(){P(this).hasClass("visited")&&P(this).removeClass("visited")}),P(this).addClass("visited"),D.val(parseInt(P(this).text()))}),p.undelegate("li.jcDateColor","dblclick").delegate("li.jcDateColor","click",function(){G()}),c.die().live("click",function(){z(w,g,k)}),u.die().live("click",function(){P("input.dateVisited").val("")}),h.die().live("click",function(){G()}),e.addClass(K.IcoClass).die().live(K.Event,function(e){P(this).addClass("dateVisited");var t=P(this).offset();i.css({left:t.left+K.Left,top:t.top+K.Top}),i.show(K.Speed),v.show(),r.hide(),o.hide(),P("#d_prev,#d_next").show(),f.show(),n.show(),s.show()}),i.die().live("mouseleave",function(){setTimeout(J,K.Timeout)})})}}(jQuery);